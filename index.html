<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Marker WebAR (MindAR + Three.js)</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #000;
        }

        /* MindARã®video/canvasãŒå…¨ç”»é¢ã§é‡ãªã‚‹ */
        #ar-container {
            position: fixed;
            inset: 0;
            overflow: hidden;
        }

        /* ç”»é¢ä¸Šã«ã¡ã‚‡ã£ã¨ã—ãŸUI */
        .ui {
            position: fixed;
            left: 12px;
            right: 12px;
            bottom: 12px;
            display: flex;
            gap: 8px;
            justify-content: space-between;
            pointer-events: none;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", sans-serif;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, .6);
        }

        .pill {
            pointer-events: auto;
            background: rgba(0, 0, 0, .45);
            border: 1px solid rgba(255, 255, 255, .2);
            padding: 8px 10px;
            border-radius: 999px;
        }

        .hint {
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="ar-container"></div>
    <div class="ui">
        <div class="pill">ğŸ¯ ãƒãƒ¼ã‚«ãƒ¼ã«ã‚«ãƒ¡ãƒ©ã‚’å‘ã‘ã¦ãã ã•ã„</div>
        <div class="hint">æ˜ã‚‹ã„å ´æ‰€ãƒ»ç„¡åœ°èƒŒæ™¯ãŒå®‰å®š</div>
    </div>

    <!-- Three.jsï¼ˆUMDï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
    <!-- MindARï¼ˆImage Tracking / Three.js çµ±åˆãƒ“ãƒ«ãƒ‰ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"></script>

    <!-- GLTFLoader ã¯ ES Module ã‚’ä½¿ã† -->
    <script type="module">
        import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/loaders/GLTFLoader.js";

        // 1) MindARåˆæœŸåŒ–
        const mindarThree = new window.MINDAR.IMAGE.MindARThree({
            container: document.querySelector("#ar-container"),
            imageTargetSrc: "./targets.mind",   // è¤‡æ•°ç”»åƒå¯¾å¿œå¯ï¼ˆå¾Œè¿°ï¼‰
            uiScanning: false,                   // ç‹¬è‡ªUIã‚’ä½¿ã†ãŸã‚MindARæ¨™æº–UIã¯OFF
            uiLoading: "no",                     // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UIç„¡åŠ¹ï¼ˆä»»æ„ï¼‰
            filterMinCF: 0.001,                 // èªè­˜ã®å®‰å®šåº¦èª¿æ•´ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
            warmupTolerance: 0.0
        });

        const { renderer, scene, camera } = mindarThree;

        // 2) ç…§æ˜ï¼ˆè»½é‡ï¼†è¦‹ãˆã‚„ã™ã•é‡è¦–ï¼‰
        const hemi = new THREE.HemisphereLight(0xffffff, 0x444466, 1.0);
        scene.add(hemi);
        const dir = new THREE.DirectionalLight(0xffffff, 0.8);
        dir.position.set(1, 1.5, 1);
        scene.add(dir);

        // 3) ã‚¢ãƒ³ã‚«ãƒ¼ï¼ˆtargets.mind ã® 0ç•ªã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ç´ã¥ãã€ŒåŸç‚¹ã€ï¼‰
        const anchor = mindarThree.addAnchor(0);

        // 4) GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
        const loader = new GLTFLoader();
        let model;
        loader.load(
            "./model.glb",
            (gltf) => {
                model = gltf.scene;
                // ã‚¹ã‚±ãƒ¼ãƒ«ã¨åˆæœŸå§¿å‹¢ã¯ãƒãƒ¼ã‚«ãƒ¼å®Ÿå¯¸ã«åˆã‚ã›ã¦èª¿æ•´
                model.scale.set(0.2, 0.2, 0.2);      // å°ã•ã‘ã‚Œã°æ•°å€¤ã‚’ä¸Šã’ã‚‹
                model.position.set(0, 0, 0);         // ã‚¢ãƒ³ã‚«ãƒ¼åŸç‚¹ï¼ˆãƒãƒ¼ã‚«ãƒ¼ä¸­å¿ƒï¼‰ã«åº§æ¨™åˆã‚ã›
                model.rotation.set(0, 0, 0);
                anchor.group.add(model);
            },
            (ev) => { /* èª­ã¿è¾¼ã¿é€²æ—ï¼ˆä»»æ„ï¼‰ */ },
            (err) => { console.error("GLBèª­ã¿è¾¼ã¿å¤±æ•—:", err); }
        );

        // 5) ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¤œå‡ºæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä»»æ„æ¼”å‡ºï¼‰
        anchor.onTargetFound = () => {
            console.log("Target Found");
            // ä¾‹ï¼šã‚¢ãƒ‹ãƒ¡å†ç”Ÿã‚„éŸ³å£°å†ç”Ÿãªã©ã®ãƒˆãƒªã‚¬ãƒ¼
        };
        anchor.onTargetLost = () => {
            console.log("Target Lost");
            // ä¾‹ï¼šä¸€æ™‚åœæ­¢ãƒ»ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆãªã©
        };

        // 6) ã‚¹ã‚¿ãƒ¼ãƒˆï¼†ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ«ãƒ¼ãƒ—
        await mindarThree.start();
        renderer.setAnimationLoop(() => {
            // è»½ã„ã‚¢ãƒ‹ãƒ¡ï¼ˆä»»æ„ï¼‰
            if (model) model.rotation.y += 0.01;
            renderer.render(scene, camera);
        });

        // ç”»é¢ãƒªã‚µã‚¤ã‚ºå¯¾ç­–ã¯ MindAR å†…éƒ¨ã§å‡¦ç†ã•ã‚Œã‚‹ãŸã‚é€šå¸¸ä¸è¦
    </script>
</body>

</html>